<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„ÇÆ„É£„É©„É™„Éº</title>
    <!-- Tailwind CSS („Éá„Ç∂„Ç§„É≥Áî®) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞„Çπ„Éî„Éä„Éº„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 min-h-screen">

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="p-4 md:p-8">
        
        <!-- „Éò„ÉÉ„ÉÄ„Éº„Ç®„É™„Ç¢ -->
        <div class="max-w-6xl mx-auto mb-8 text-center">
            <p id="status-text" class="text-gray-500 text-sm">Ë™≠„ÅøËæº„Åø‰∏≠...</p>
            <p id="connection-status" class="text-xs text-blue-500 mt-1 hidden">„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÈÄ£Êê∫‰∏≠</p>
        </div>

        <!-- „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫„Ç®„É™„Ç¢ (ÈÄöÂ∏∏„ÅØÈùûË°®Á§∫) -->
        <div id="error-container" class="max-w-6xl mx-auto mb-4 p-4 bg-red-100 text-red-700 rounded-lg text-center hidden">
            <span id="error-message"></span><br/>
            <span class="text-sm text-gray-600">ÔºàÁèæÂú®„ÅØ„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„ÅôÔºâ</span>
        </div>

        <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞‰∏≠„Çπ„Éî„Éä„Éº -->
        <div id="loading-spinner" class="flex justify-center items-center h-64">
            <svg class="animate-spin text-gray-400 h-12 w-12" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </div>

        <!-- ÂÜôÁúü‰∏ÄË¶ß„Ç∞„É™„ÉÉ„Éâ (JS„Åß„Åì„Åì„Å´ÂÜôÁúü„ÅåËøΩÂä†„Åï„Çå„Åæ„Åô) -->
        <div id="gallery-grid" class="max-w-6xl mx-auto grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 hidden">
            <!-- ÂÜôÁúüË¶ÅÁ¥†„ÅØ„Åì„Åì„Å´ÊåøÂÖ•„Åï„Çå„Åæ„Åô -->
        </div>

    </div>

    <!-- „É©„Ç§„Éà„Éú„ÉÉ„ÇØ„Çπ (Êã°Â§ßË°®Á§∫„É¢„Éº„ÉÄ„É´) -->
    <div id="lightbox" class="fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
        
        <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ -->
        <button onclick="closeGallery()" class="absolute top-4 right-4 text-white/70 hover:text-white z-50 p-2 transition-colors">
            <!-- X„Ç¢„Ç§„Ç≥„É≥ -->
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>

        <!-- ÁîªÂÉèË°®Á§∫„Ç®„É™„Ç¢ -->
        <div class="relative w-full h-full flex flex-col items-center justify-center p-4">
            <div class="relative max-w-[90vw] max-h-[85vh]">
                <img id="lightbox-img" src="" alt="" class="max-w-full max-h-[80vh] object-contain shadow-2xl rounded-sm select-none">
                
                <!-- „Çø„Ç§„Éà„É´„Å®„Ç´„Ç¶„É≥„Çø„Éº -->
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 text-white">
                    <div class="flex justify-between items-end">
                        <span id="lightbox-title" class="font-medium text-lg md:text-xl drop-shadow-md"></span>
                        <span id="lightbox-counter" class="text-sm opacity-80 shrink-0 ml-4 font-mono"></span>
                    </div>
                </div>
            </div>

            <!-- Â∑¶Áü¢Âç∞ (Ââç„Å∏) -->
            <div onclick="prevImage(event)" class="absolute inset-y-0 left-0 w-1/5 md:w-1/4 flex items-center justify-start pl-4 cursor-pointer group hover:bg-white/5 transition-colors">
                <button class="bg-black/30 group-hover:bg-black/60 text-white rounded-full p-2 md:p-3 transition-all backdrop-blur-sm">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Âè≥Áü¢Âç∞ (Ê¨°„Å∏) -->
            <div onclick="nextImage(event)" class="absolute inset-y-0 right-0 w-1/5 md:w-1/4 flex items-center justify-end pr-4 cursor-pointer group hover:bg-white/5 transition-colors">
                <button class="bg-black/30 group-hover:bg-black/60 text-white rounded-full p-2 md:p-3 transition-all backdrop-blur-sm">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã„Åü„ÇÅ„ÅÆÈÄèÊòé„É¨„Ç§„É§„Éº -->
        <div onclick="closeGallery()" class="absolute inset-0 -z-10"></div>
    </div>

    <!-- JavaScript„É≠„Ç∏„ÉÉ„ÇØ -->
    <script>
        // ==========================================
        // üõ†Ô∏è Ë®≠ÂÆö„Ç®„É™„Ç¢: Google„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàÈÄ£Êê∫
        // ==========================================
        
        // „ÄêÈáçË¶Å„Äë„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÊ∫ñÂÇô:
        // 1. „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂè≥‰∏ä„ÅÆ„ÄåÂÖ±Êúâ„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
        // 2. ‰∏ÄËà¨ÁöÑ„Å™„Ç¢„ÇØ„Çª„Çπ„Çí„Äå„É™„É≥„ÇØ„ÇíÁü•„Å£„Å¶„ÅÑ„ÇãÂÖ®Âì°„Äç„Å´Â§âÊõ¥
        // 3. „Éñ„É©„Ç¶„Ç∂„ÅÆURL„Éê„Éº„Å´„ÅÇ„ÇãIDÔºà/d/„Å®/edit„ÅÆÈñì„ÅÆÊñáÂ≠óÂàóÔºâ„Çí‰ΩøÁî®„Åó„Åæ„Åô
        
        // URL„Éë„É©„É°„Éº„Çø 'id' „Åå„ÅÇ„Çå„Å∞„Åù„Çå„ÇíÂÑ™ÂÖà„Åó„ÄÅ„Å™„Åë„Çå„Å∞„Éá„Éï„Ç©„É´„Éà„ÅÆID„Çí‰ΩøÁî®„Åó„Åæ„Åô
        // ‰ΩøÁî®‰æã: index.html?id=YOUR_SPREADSHEET_ID
        const urlParams = new URLSearchParams(window.location.search);
        const idParam = urlParams.get('id');
        
        // „Åì„Åì„Å´„Éá„Éï„Ç©„É´„Éà„Åß‰ΩøÁî®„Åó„Åü„ÅÑ„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆID„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        // https://docs.google.com/spreadsheets/d/XXXXXXX.../edit... „Å™„Çâ XXXXXXX... „ÅÆÈÉ®ÂàÜ„ÄÇ
        const DEFAULT_SHEET_ID = ""; 
        
        const activeSheetId = idParam || DEFAULT_SHEET_ID;

        // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÁî®„ÅÆ„Çµ„É≥„Éó„É´„Éá„Éº„ÇøÔºà3‰ª∂Ôºâ
        const SAMPLE_DATA = [
            { id: 1, src: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?q=80&w=2070&auto=format&fit=crop", title: "Mountain View (Demo)" },
            { id: 2, src: "https://images.unsplash.com/photo-1475924156734-496f6cac6ec1?q=80&w=2070&auto=format&fit=crop", title: "Ocean Sunset (Demo)" },
            { id: 3, src: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=2070&auto=format&fit=crop", title: "Forest Path (Demo)" }
        ];

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let photoData = [];
        let currentIndex = null;

        // HTMLË¶ÅÁ¥†„ÅÆÂèÇÁÖß„ÇíÂèñÂæó
        const galleryGrid = document.getElementById('gallery-grid');
        const loadingSpinner = document.getElementById('loading-spinner');
        const statusText = document.getElementById('status-text');
        const connectionStatus = document.getElementById('connection-status');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxTitle = document.getElementById('lightbox-title');
        const lightboxCounter = document.getElementById('lightbox-counter');

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÈñãÂßã
        async function init() {
            if (!activeSheetId) {
                // ID„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË°®Á§∫
                loadData(SAMPLE_DATA);
                return;
            }

            try {
                // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàID„Åã„ÇâCSV„Ç®„ÇØ„Çπ„Éù„Éº„ÉàURL„ÇíÊßãÁØâ
                // Ê≥®ÊÑè: „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆÂÖ±ÊúâË®≠ÂÆö„Åß„Äå„É™„É≥„ÇØ„ÇíÁü•„Å£„Å¶„ÅÑ„ÇãÂÖ®Âì°„ÅåÈñ≤Ë¶ßÂèØ„Äç„Å´„Å™„Å£„Å¶„ÅÑ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô
                const csvUrl = `https://docs.google.com/spreadsheets/d/${activeSheetId}/export?format=csv`;
                
                const response = await fetch(csvUrl);
                if (!response.ok) {
                    if (response.status === 404) throw new Error('„Ç∑„Éº„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇID„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    if (response.status === 401 || response.status === 403) throw new Error('„Ç¢„ÇØ„Çª„ÇπÊ®©Èôê„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„Äå„É™„É≥„ÇØ„ÇíÁü•„Å£„Å¶„ÅÑ„ÇãÂÖ®Âì°„Äç„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    throw new Error('„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
                const text = await response.text();
                
                // CSV„Çí„Éë„Éº„Çπ„Åó„Å¶„Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÈÖçÂàó„Å´Â§âÊèõ
                const lines = text.split('\n');
                const parsedData = lines.slice(1) // „Éò„ÉÉ„ÉÄ„ÉºË°å„Çí„Çπ„Ç≠„ÉÉ„Éó
                    .filter(line => line.trim() !== '')
                    .map((line, index) => {
                        const parts = line.split(',');
                        // URLÂèñÂæó (AÂàó: index 0)
                        const src = parts[0]?.trim();
                        // „Çø„Ç§„Éà„É´ÂèñÂæó (BÂàó: index 1 „ÅÆ„Åø„Çí‰ΩøÁî®)
                        let title = parts[1]?.trim() || '';
                        
                        // ÂÖàÈ†≠„Å®Êú´Â∞æ„ÅÆÂºïÁî®Á¨¶„Åå„ÅÇ„Çå„Å∞Èô§Âéª
                        title = title.replace(/^"(.*)"$/, '$1');
                        
                        if (!src) return null;
                        return { id: index + 1, src, title };
                    })
                    .filter(item => item !== null);

                if (parsedData.length === 0) {
                     throw new Error('„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ');
                }

                loadData(parsedData);
                connectionStatus.textContent = `IDÈÄ£Êê∫‰∏≠: ${activeSheetId.substring(0,6)}...`;
                connectionStatus.classList.remove('hidden');

            } catch (err) {
                console.error(err);
                errorMessage.textContent = `„Ç®„É©„Éº: ${err.message}`;
                errorContainer.classList.remove('hidden');
                loadData(SAMPLE_DATA); // „Ç®„É©„ÉºÊôÇ„ÅØ„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË°®Á§∫
            }
        }

        // „Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂá¶ÁêÜ
        function loadData(data) {
            photoData = data;
            loadingSpinner.classList.add('hidden');
            galleryGrid.classList.remove('hidden');
            statusText.textContent = "ÂÜôÁúü„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®Êã°Â§ßË°®Á§∫„Åï„Çå„Åæ„Åô";
            renderGallery();
        }

        // „Çµ„É†„Éç„Ç§„É´„Ç∞„É™„ÉÉ„Éâ„ÅÆÊèèÁîª
        function renderGallery() {
            galleryGrid.innerHTML = ''; // „ÇØ„É™„Ç¢
            photoData.forEach((photo, index) => {
                const div = document.createElement('div');
                div.className = "aspect-[3/2] overflow-hidden rounded-lg shadow-md cursor-pointer hover:shadow-xl hover:scale-105 transition-all duration-300 bg-white group";
                div.onclick = () => openGallery(index);
                
                const img = document.createElement('img');
                img.src = photo.src;
                img.alt = photo.title;
                img.className = "w-full h-full object-cover group-hover:opacity-90 transition-opacity";
                img.loading = "lazy";
                
                div.appendChild(img);
                galleryGrid.appendChild(div);
            });
        }

        // Êã°Â§ßË°®Á§∫Ôºà„É©„Ç§„Éà„Éú„ÉÉ„ÇØ„ÇπÔºâ„ÇíÈñã„Åè
        function openGallery(index) {
            currentIndex = index;
            updateLightbox();
            lightbox.classList.remove('hidden');
            // „Éï„Çß„Éº„Éâ„Ç§„É≥„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            setTimeout(() => lightbox.classList.remove('opacity-0'), 10);
            document.body.style.overflow = 'hidden'; // ËÉåÊôØ„Çπ„ÇØ„É≠„Éº„É´Á¶ÅÊ≠¢
        }

        // Êã°Â§ßË°®Á§∫„ÇíÈñâ„Åò„Çã
        function closeGallery() {
            currentIndex = null;
            lightbox.classList.add('opacity-0');
            setTimeout(() => {
                lightbox.classList.add('hidden');
                document.body.style.overflow = ''; // „Çπ„ÇØ„É≠„Éº„É´Ëß£Èô§
            }, 300);
        }

        // „É©„Ç§„Éà„Éú„ÉÉ„ÇØ„ÇπÂÜÖ„ÅÆÁîªÂÉèÊõ¥Êñ∞
        function updateLightbox() {
            if (currentIndex === null || !photoData[currentIndex]) return;
            const photo = photoData[currentIndex];
            
            lightboxImg.src = photo.src;
            lightboxImg.alt = photo.title;
            lightboxTitle.textContent = photo.title;
            lightboxCounter.textContent = `${currentIndex + 1} / ${photoData.length}`;
        }

        // Ê¨°„ÅÆÁîªÂÉè„Å∏
        function nextImage(e) {
            if(e) e.stopPropagation(); // ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÅÆ‰ºùÊí≠Èò≤Ê≠¢
            if (currentIndex !== null) {
                currentIndex = (currentIndex + 1) % photoData.length;
                updateLightbox();
            }
        }

        // Ââç„ÅÆÁîªÂÉè„Å∏
        function prevImage(e) {
            if(e) e.stopPropagation();
            if (currentIndex !== null) {
                currentIndex = (currentIndex - 1 + photoData.length) % photoData.length;
                updateLightbox();
            }
        }

        // „Ç≠„Éº„Éú„Éº„ÉâÊìç‰ΩúÂØæÂøú
        document.addEventListener('keydown', (e) => {
            if (currentIndex === null) return;
            switch(e.key) {
                case 'ArrowRight': nextImage(); break;
                case 'ArrowLeft': prevImage(); break;
                case 'Escape': closeGallery(); break;
            }
        });

        // ÂÆüË°åÈñãÂßã
        init();
    </script>
</body>
</html>
